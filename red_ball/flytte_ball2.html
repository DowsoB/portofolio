<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Level 2</title>
</head>
<style>
  body {
    overflow: hidden;
    margin: 0;
  }

  canvas {
    display: block;
  }

  #gameOverScreen {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    text-align: center;
    padding-top: 200px;
  }
 
  #gameOverScreen h1 {
    font-size: 50px;
    margin-bottom: 20px;
  }
 
  #gameOverScreen button {
    padding: 10px 20px;
    font-size: 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
  }

  #VictoryScreen {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    text-align: center;
    padding-top: 200px;
  }
 
  #VictoryScreen h1 {
    font-size: 50px;
    margin-bottom: 20px;
  }
 
  #VictoryScreen button {
    padding: 10px 20px;
    font-size: 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
  }

</style>
 
<body>

  <div id="gameOverScreen">
    <h1>Game Over</h1>
    <button onclick="resetGame()">Reset</button>
  </div>

  <div id="VictoryScreen">
    <h1>Winner</h1>
    <button onclick="nextlevel()">Next level</button>
    <button onclick="resetGame()">Reset</button>
  </div>

  <canvas id="minCanvas" width="4000" height="700"></canvas>

  <script>
    let canvas = document.getElementById("minCanvas");
    let ctx = canvas.getContext("2d");
    const win_sound = new Audio("happy.mp3");

    let ball = {
      radius: 25,
      xpos: 30,
      ypos: 470,
      xfart: 0,
      xretning: 0,
      yfart: 0,
      yretning: 0,
      velY: 0,
      velX: 0,
      grav: 0.2,
      bounce: 0.3,
      rotationAngle: 0,
      onGround: false
    };

    let blocks = [
      { xpos: 900, ypos: 300, width: 100, height: 400, color: "green" },
      { xpos: 2500, ypos: 500, width: 100, height: 200, color: "green" },
      { xpos: 3490, ypos: 500, width: 100, height: 200, color: "green" },
    ];

    let platforms = [
      { xpos: 700, ypos: 550, width: 200, height: 50, color: "brown" },
      { xpos: 1200, ypos: 390, width: 100, height: 50, color: "brown" },
      { xpos: 1600, ypos: 490, width: 100, height: 50, color: "brown" },
      { xpos: 2000, ypos: 390, width: 100, height: 50, color: "brown" },
      { xpos: 800, ypos: 390, width: 100, height: 50, color: "brown" },
    ];

    let trees = [
      { xpos: 500, ypos: 0, width: 50, height: canvas.height, color: "rgba(139, 69, 19, 0.6)" },
      { xpos: 1160, ypos: 0, width: 50, height: canvas.height, color: "rgba(139, 69, 19, 0.6)" },
      { xpos: 1400, ypos: 0, width: 50, height: canvas.height, color: "rgba(139, 69, 19, 0.6)" },
      { xpos: 1700, ypos: 0, width: 50, height: canvas.height, color: "rgba(139, 69, 19, 0.6)" },
      { xpos: 2200, ypos: 0, width: 50, height: canvas.height, color: "rgba(139, 69, 19, 0.6)" },
      { xpos: 2700, ypos: 0, width: 50, height: canvas.height, color: "rgba(139, 69, 19, 0.6)" },
      { xpos: 3500, ypos: 0, width: 50, height: canvas.height, color: "rgba(139, 69, 19, 0.6)" },
    ];

    let spikes = [
      { xpos: 850, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 800, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 750, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 700, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 850, ypos: 500, width: 50, height: 50, color: "silver"},
      { xpos: 800, ypos: 500, width: 50, height: 50, color: "silver"},
      { xpos: 1000, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1050, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1100, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1150, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1200, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1250, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1300, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1350, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1400, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1450, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1500, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1550, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1600, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1650, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1700, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1750, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1800, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1850, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1900, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 1950, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 2000, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 2050, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 2100, ypos: 650, width: 50, height: 50, color: "silver"},
      { xpos: 2150, ypos: 650, width: 50, height: 50, color: "silver"},
    ];

    let enemies = [
      { xpos: 3000, ypos: 600, width: 100, height: 100},
    ];

    let goal = {
      xpos: canvas.width-40,
      ypos: 0,
      width: 50,
      height: canvas.height,
      farge: "yellow",
    };


    window.onload = oppstart;


    function oppstart() {
      tegn();

      document.onkeydown = function (evt) {
        let taster = { venstre: 37, opp: 38, hoyre: 39 };

        if (evt.keyCode === taster.hoyre) {
          ball.xretning = 1;
          ball.xfart = 3;
          ball.velX = 1;
        }

        if (evt.keyCode === taster.venstre) {
          ball.xretning = -1;
          ball.xfart = 3;
          ball.velX = -1;
        }

        if (evt.keyCode === taster.opp && ball.ypos + ball.radius >= 650) {
          ball.velY = -10;
        }

        if (evt.keyCode === taster.opp && ball.onGround) {
          ball.velY = -10;
          ball.onGround = false;
        }
      };

      document.onkeyup = function (evt) {
        let taster = { venstre: 37, opp: 38, hoyre: 39 };

        if (evt.keyCode === taster.hoyre || evt.keyCode === taster.venstre) {
          ball.xfart = 0;
          ball.xretning = 0;
        }
      };

      const audio = new Audio("monkey.mp3"); // Create a new audio object with the file 'monkey.mp3'
      audio.loop = true;                     // Set the audio to loop indefinitely

      document.body.addEventListener("keydown", () => {
      audio.play();                        // Play the audio when any key is pressed
      }, { once: true }); 
    }

    function tegn() {
      const img = new Image();
        img.src = "manface.png";
        img.onload = function () {
            if (ball.radius > 0) {
                window.scrollTo(canvas.offsetLeft + ball.xpos - window.innerWidth / 2,
                    canvas.offsetTop + ball.ypos - window.innerHeight / 2);
            }
            backgrunn();
            tree();
            grass();
            block();
            platform();
            goals();
            balls();
            tegnenemy();
            tegnspike();
        }
        requestAnimationFrame(tegn);
    }



    function backgrunn() {
      ctx.fillStyle = "lightblue";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function tree() {
      trees.forEach(tree => {
        ctx.fillStyle = tree.color;
        ctx.fillRect(tree.xpos, tree.ypos, tree.width, tree.height);
      });
    }

    function grass() {
      ctx.fillStyle = "lightgreen";
      ctx.fillRect(0, 680, canvas.width, 30);
    }

    function block() {
      blocks.forEach(block => {
       ctx.fillStyle = block.color;
       ctx.fillRect(block.xpos, block.ypos, block.width, block.height);
      });
    }

    function platform() {
      platforms.forEach(platform => {
       ctx.fillStyle = platform.color;
       ctx.fillRect(platform.xpos, platform.ypos, platform.width, platform.height);
      });
    }

    function goals() {
      ctx.fillStyle = goal.farge;
       ctx.fillRect(goal.xpos, goal.ypos, goal.width, goal.height);
       sjekkvictory(goal);
    }

    function balls() {
      const img = new Image();
        img.src = "manface.png";
      ctx.save();

      ctx.translate(ball.xpos, ball.ypos);
      ctx.rotate(ball.rotationAngle);

      ctx.fillStyle = "Red";
      ctx.beginPath();
      ctx.arc(0, 0, ball.radius, 0, Math.PI * 2);
      ctx.fill();

      let x = -ball.radius / 2;
      let y = -ball.radius / 2;
      let size = ball.radius;
      ctx.drawImage(img, x, y, size, size);

      ctx.restore();

      if (ball.xretning !== 0) {
        ball.rotationAngle += ball.xretning * 0.05;
      }

      if (ball.xpos - ball.radius <= 0 || ball.xpos + ball.radius >= canvas.width) {
        ball.xretning *= -1;
      }
      ball.xpos += ball.xretning * ball.xfart;

      ball.velY += ball.grav;
      if (ball.velY > 10) {
        ball.velY = 10;
      }
      ball.ypos += ball.velY;

      if (ball.ypos + ball.radius > canvas.height) {
        ball.ypos = canvas.height - ball.radius;
        ball.velY *= -ball.bounce;
        ball.onGround = true;
      }

      blocks.forEach(block => sjekkKollisjon(block));
      platforms.forEach(platform => sjekkplattform(platform));
    }

  function tegnspike() {
    spikes.forEach(spike => {
      ctx.fillStyle = spike.color;
      ctx.beginPath();
      ctx.moveTo(spike.xpos, spike.ypos + spike.height); // Bottom-left corner
      ctx.lineTo(spike.xpos + spike.width / 2, spike.ypos); // Top corner
      ctx.lineTo(spike.xpos + spike.width, spike.ypos + spike.height); // Bottom-right corner
      ctx.closePath();
      ctx.fill();

      sjekkdanger(spike);
      });
  }

  function tegnenemy() {
   const img = new Image();
   img.src = "trump.png";

  // Wait for the image to load before drawing it
  img.onload = function() {
    enemies.forEach(enemy => {
      ctx.fillRect(enemy.xpos, enemy.ypos, enemy.width, enemy.height);
      sjekkdanger(enemy);

      // Adjusting the x and y values for correct positioning
      let x = enemy.xpos;
      let y = enemy.ypos;

      // Set size as per your needs; here it's based on enemy width and height
      let size = Math.max(enemy.width, enemy.height); // Use the maximum size for square scaling

      // Draw the image
      ctx.drawImage(img, x, y, size, size);

      // Move the enemy left and right
      if (!enemy.direction) {
        enemy.direction = 1; // Initialize direction (1 for right, -1 for left)
      }

      enemy.xpos += enemy.direction * 2; // Adjust speed as needed

      // Reverse direction if the enemy hits the canvas boundaries
      if (enemy.xpos <= 0 || enemy.xpos + enemy.width >= canvas.width) {
        enemy.direction *= -1;
      }

      // Check collision with blocks and reverse direction
      blocks.forEach(block => {
        if (
          enemy.xpos + enemy.width > block.xpos &&
          enemy.xpos < block.xpos + block.width &&
          enemy.ypos + enemy.height > block.ypos &&
          enemy.ypos < block.ypos + block.height
        ) {
          enemy.direction *= -1;
          new Audio("china.mp3").play();
        }
      });
    });
  };
}


    function sjekkKollisjon(stop) {
      if (
        ball.xpos + ball.radius > stop.xpos &&
        ball.xpos - ball.radius < stop.xpos + stop.width &&
        ball.ypos + ball.radius > stop.ypos &&
        ball.ypos - ball.radius < stop.ypos + stop.height
      ) {
        if (ball.ypos + ball.radius - ball.velY <= stop.ypos) {
          ball.ypos = stop.ypos - ball.radius;
          ball.velY *= -ball.bounce;
          ball.onGround = true; // Ball is on the block
        } else if (ball.xpos - ball.radius < stop.xpos + stop.width && ball.xpos + ball.radius > stop.xpos) {
          if (ball.xpos < stop.xpos) {
            ball.xpos = stop.xpos - ball.radius;
          } else {
            ball.xpos = stop.xpos + stop.width + ball.radius;
          }
          ball.xretning = 0;
          ball.xfart = 0;
        } else if (ball.ypos - ball.radius < stop.ypos + stop.height) {
          ball.ypos = stop.ypos + stop.height + ball.radius;
          ball.velY = 0;
        }
      }
    }

    function sjekkplattform(ontop) {
      if (
        ball.xpos + ball.radius > ontop.xpos &&
        ball.xpos - ball.radius < ontop.xpos + ontop.width &&
        ball.ypos + ball.radius > ontop.ypos &&
        ball.ypos - ball.radius < ontop.ypos + ontop.height
      ) {
        // Kollisjon oppdaget, juster ballens posisjon
        if (ball.ypos + ball.radius - ball.velY <= ontop.ypos) {
          // Treffer toppen av objektet
          ball.ypos = ontop.ypos - ball.radius;
          ball.velY *= -ball.bounce; // Ballen spretter
          ball.onGround = true;
        }
      }
    }

    function sjekkdanger(oh_no) {
    if (
        ball.xpos + ball.radius > oh_no.xpos &&
        ball.xpos - ball.radius < oh_no.xpos + oh_no.width &&
        ball.ypos + ball.radius > oh_no.ypos &&
        ball.ypos - ball.radius < oh_no.ypos + oh_no.height
    ) {
        dead();
    }
    }

    function sjekkvictory() {
      if (
        ball.xpos + ball.radius > goal.xpos &&
        ball.xpos - ball.radius < goal.xpos + goal.width &&
        ball.ypos + ball.radius > goal.ypos &&
        ball.ypos - ball.radius < goal.ypos + goal.height
      ) {
        victory();
      }
    }
    
    function victory() {
      document.getElementById("VictoryScreen").style.display = "block";
      win_sound.play();
    }
 
    function nextlevel() {
      location.href = "flytte_ball3.html";
    }
 
    function dead() {
      document.getElementById("gameOverScreen").style.display = "block";
      ball.velY = 0;
      ball.velX = 0;
      ball.radius = 0;
      document.onkeydown = null;
      document.onkeyup = null;
    }
 
    function resetGame() {
    location.reload();
    }
  </script>
</body>
</html>